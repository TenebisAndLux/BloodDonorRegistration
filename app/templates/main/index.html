<!DOCTYPE html>
<html lang="ru">
<head>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –¥–æ–Ω–æ—Ä–æ–≤ –∫—Ä–æ–≤–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/list_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modal_styles.css') }}">
</head>
<body>
<div class="header">
    <div class="left-group">
        <div class="hospital-name" id="hospital-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="navigation">
            <button onclick="location.href='/donor/list'">‚úé –î–æ–Ω–æ—Ä—ã</button>
            <button onclick="location.href='/donor/reports'">üìú –û—Ç—á–µ—Ç—ã</button>
            <button onclick="location.href='/blood_bank'">üóë –ë–∞–Ω–∫ –∫—Ä–æ–≤–∏</button>
        </div>
    </div>

    <div class="name-container" onmouseenter="showLogoutButton()" onmouseleave="hideLogoutButton()">
        <div class="name" onfocus="showLogoutButton()" id="doctor-name">
            –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>
        <div class="exit-button" style="display: none" onmouseenter="showLogoutButton()"
             onmouseleave="hideLogoutButton()" onclick="location.href='/login'">–í—ã—Ö–æ–¥
        </div>
    </div>
</div>

<div id="loading" style="display: none; text-align: center; padding: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const loadingElement = document.getElementById('loading');

        function showLoading() {
            loadingElement.style.display = 'block';
        }

        function hideLoading() {
            loadingElement.style.display = 'none';
        }

        fetch('/doctor/current')
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    document.getElementById('doctor-name').textContent = '–í—Ä–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    document.getElementById('hospital-name').textContent = '–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
                } else {
                    document.getElementById('doctor-name').textContent = `${data.secondname} ${data.name.charAt(0)}.`;
                    document.getElementById('hospital-name').textContent = data.institutionname;
                    document.getElementById('hospital-name').dataset.institutionCode = data.institutioncode;
                }
                searchDonors();
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('doctor-name').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                document.getElementById('hospital-name').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                searchDonors();
                hideLoading();
            });
    });

    function setTrueShouldGetDonorsState() {
        localStorage.setItem('shouldGetDonors', 'true');
    }

    function setFalseShouldGetDonorsState() {
        localStorage.setItem('shouldGetDonors', 'false');
    }

    function getShouldGetDonorsState() {
        return localStorage.getItem('shouldGetDonors') === 'true';
    }
</script>

<main class="content-wrapper">

<div class="search-container">
    <form id="search-form">
        <table>
            <tr>
                <th><label for="surname">–§–∞–º–∏–ª–∏—è:</label></th>
                <td><input type="text" id="surname" name="surname"></td>
                <th><label for="name">–ò–º—è:</label></th>
                <td><input type="text" id="name" name="name"></td>
                <th><label for="secondname">–û—Ç—á–µ—Å—Ç–≤–æ:</label></th>
                <td><input type="text" id="secondname" name="secondname"></td>
            </tr>
            <tr>
                <th><label for="passportdata">–ü–∞—Å–ø–æ—Ä—Ç:</label></th>
                <td><input type="text" id="passportdata" name="passportdata"></td>
                <th><label for="address">–ê–¥—Ä–µ—Å:</label></th>
                <td><input type="text" id="address" name="address"></td>
                <th><label for="phonenumber">–¢–µ–ª–µ—Ñ–æ–Ω:</label></th>
                <td><input type="text" id="phonenumber" name="phonenumber"></td>
            </tr>
            <tr>
                <th><label for="polis">–ü–æ–ª–∏—Å:</label></th>
                <td><input type="text" id="polis" name="polis"></td>
                <th><label for="birthday">–î/–†:</label></th>
                <td><input type="date" id="birthday" name="birthday"></td>
                <th><label for="gender">–ü–æ–ª:</label></th>
                <td>
                    <select id="gender" name="gender">
                        <option value="">–í—Å–µ</option>
                        <option value="M">–ú—É–∂—Å–∫–æ–π</option>
                        <option value="F">–ñ–µ–Ω—Å–∫–∏–π</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th><label for="bloodgroup">–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏:</label></th>
                <td>
                    <select id="bloodgroup" name="bloodgroup">
                        <option value="">–í—Å–µ</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="AB">AB</option>
                        <option value="O">O</option>
                    </select>
                </td>
                <th><label for="rhfactor">–†–µ–∑—É—Å-—Ñ–∞–∫—Ç–æ—Ä:</label></th>
                <td>
                    <select id="rhfactor" name="rhfactor">
                        <option value="">–í—Å–µ</option>
                        <option value="+">+</option>
                        <option value="-">-</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td colspan="6" style="text-align: right;">
                    <button type="button" onclick="setFalseShouldGetDonorsState(); searchDonors()">–ù–∞–π—Ç–∏</button>
                    <button type="reset">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </td>
            </tr>
        </table>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.getElementById('search-form');

    searchForm.addEventListener('reset', function() {
        setTrueShouldGetDonorsState();
        setTimeout(() => searchDonors(), 0);
    });
});
</script>

<div class="action-buttons">
    <button onclick="addDonorModal()">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–Ω–æ—Ä–∞</button>
    <button onclick="addBloodCollectionModal()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–±–æ—Ä –∫—Ä–æ–≤–∏</button>
</div>

<div id="addDonorModal" class="modal-add">
    <div class="modal-add-content">
        <span class="close" onclick="closeAddModal()">√ó</span>
        <form id="addDonorForm">
            <table>
                <tr>
                    <th><label for="addDonorName">–ò–º—è:</label></th>
                    <td><input type="text" id="addDonorName" name="name" required></td>
                    <th><label for="addDonorSecondName">–§–∞–º–∏–ª–∏—è:</label></th>
                    <td><input type="text" id="addDonorSecondName" name="secondname" required></td>
                    <th><label for="addDonorSurname">–û—Ç—á–µ—Å—Ç–≤–æ:</label></th>
                    <td><input type="text" id="addDonorSurname" name="surname"></td>
                </tr>
                <tr>
                    <th><label for="addDonorBirthday">–î/–†:</label></th>
                    <td><input type="date" id="addDonorBirthday" name="birthday" required></td>
                    <th><label for="addDonorGender">–ü–æ–ª:</label></th>
                    <td>
                        <select id="addDonorGender" name="gender" required>
                            <option value="M">–ú—É–∂—Å–∫–æ–π</option>
                            <option value="F">–ñ–µ–Ω—Å–∫–∏–π</option>
                        </select>
                    </td>
                    <th><label for="addDonorAddress">–ê–¥—Ä–µ—Å:</label></th>
                    <td><input type="text" id="addDonorAddress" name="address"></td>
                </tr>
                <tr>
                    <th><label for="addDonorPhoneNumber">–¢–µ–ª–µ—Ñ–æ–Ω:</label></th>
                    <td><input type="text" id="addDonorPhoneNumber" name="phonenumber"></td>
                    <th><label for="addDonorPassportData">–ü–∞—Å–ø–æ—Ä—Ç:</label></th>
                    <td><input type="text" id="addDonorPassportData" name="passportdata" required></td>
                    <th><label for="addDonorPolis">–ü–æ–ª–∏—Å:</label></th>
                    <td><input type="text" id="addDonorPolis" name="polis"></td>
                </tr>
                <tr>
                    <th><label for="addDonorBloodGroup">–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏:</label></th>
                    <td>
                        <select id="addDonorBloodGroup" name="bloodgroup" required>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="AB">AB</option>
                            <option value="O">O</option>
                        </select>
                    </td>
                    <th><label for="addDonorRhFactor">–†–µ–∑—É—Å-—Ñ–∞–∫—Ç–æ—Ä:</label></th>
                    <td>
                        <select id="addDonorRhFactor" name="rhfactor" required>
                            <option value="+">+</option>
                            <option value="-">-</option>
                        </select>
                    </td>
                </tr>
            </table>
            <div class="modal-add-action-buttons">
                <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<div id="editDonorModal" class="modal-edit">
    <div class="modal-edit-content">
        <span class="close" onclick="closeEditModal()">√ó</span>
        <form id="editDonorForm">
            <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π -->
            <input type="hidden" id="editOldDonorPassportData" name="old_passportdata">
            <input type="hidden" id="editOldDonorInstitutionCode" name="old_institutioncode">

            <table>
                <tr>
                    <th><label for="editDonorName">–ò–º—è:</label></th>
                    <td><input type="text" id="editDonorName" name="name" required></td>

                    <th><label for="editDonorSecondName">–§–∞–º–∏–ª–∏—è:</label></th>
                    <td><input type="text" id="editDonorSecondName" name="secondname" required></td>

                    <th><label for="editDonorSurname">–û—Ç—á–µ—Å—Ç–≤–æ:</label></th>
                    <td><input type="text" id="editDonorSurname" name="surname"></td>
                </tr>
                <tr>
                    <th><label for="editDonorBirthday">–î/–†:</label></th>
                    <td><input type="date" id="editDonorBirthday" name="birthday" required></td>

                    <th><label for="editDonorGender">–ü–æ–ª:</label></th>
                    <td>
                        <select id="editDonorGender" name="gender" required>
                            <option value="M">–ú—É–∂—Å–∫–æ–π</option>
                            <option value="F">–ñ–µ–Ω—Å–∫–∏–π</option>
                        </select>
                    </td>

                    <th><label for="editDonorAddress">–ê–¥—Ä–µ—Å:</label></th>
                    <td><input type="text" id="editDonorAddress" name="address"></td>
                </tr>
                <tr>
                    <th><label for="editDonorPassportData">–ü–∞—Å–ø–æ—Ä—Ç:</label></th>
                    <td><input type="text" id="editDonorPassportData" name="passportdata"></td>

                    <th><label for="editDonorPhoneNumber">–¢–µ–ª–µ—Ñ–æ–Ω:</label></th>
                    <td><input type="text" id="editDonorPhoneNumber" name="phonenumber"></td>

                    <th><label for="editDonorPolis">–ü–æ–ª–∏—Å:</label></th>
                    <td><input type="text" id="editDonorPolis" name="polis"></td>
                </tr>
                <tr>
                    <th><label for="editDonorBloodGroup">–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏:</label></th>
                    <td>
                        <select id="editDonorBloodGroup" name="bloodgroup" required>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="AB">AB</option>
                            <option value="O">O</option>
                        </select>
                    </td>

                    <th><label for="editDonorRhFactor">–†–µ–∑—É—Å-—Ñ–∞–∫—Ç–æ—Ä:</label></th>
                    <td>
                        <select id="editDonorRhFactor" name="rhfactor" required>
                            <option value="+">+</option>
                            <option value="-">-</option>
                        </select>
                    </td>

                    <th><label for="editDonorInstitutionCode">–ö–æ–¥ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è:</label></th>
                    <td><input type="text" id="editDonorInstitutionCode" name="institutioncode"></td>
                </tr>
            </table>

            <div class="modal-edit-action-buttons">
                <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </form>
    </div>
</div>


<table class="donors-list">
    <thead>
    <tr>
        <th>–ë–æ–ª—å–Ω–∏—Ü–∞ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è</th>
        <th>–ü–∞—Å–ø–æ—Ä—Ç</th>
        <th>–§–ò–û</th>
        <th>–ü–æ–ª</th>
        <th>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</th>
        <th>–ê–¥—Ä–µ—Å</th>
        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
        <th>–ü–æ–ª–∏—Å</th>
        <th>–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏</th>
        <th>–†–µ–∑—É—Å-—Ñ–∞–∫—Ç–æ—Ä</th>
        <th >–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
    </thead>
    <tbody id="donors">
    </tbody>
</table>

<div id="historyModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeHistoryModal()">√ó</span>
        <h3>–ò—Å—Ç–æ—Ä–∏—è –¥–æ–Ω–æ—Ä–∞</h3>
        <div id="historyContent">
            <div id="medicalHistoryContent">
                <p><strong>–ù–æ–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏:</strong> <span id="historyNumber"></span></p>
                <p><strong>–ü–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</strong> <span id="passportDetails"></span></p>
                <p><strong>–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:</strong> <span id="dateOfLastExamination"></span></p>
                <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞:</strong> <textarea id="analysisResults" rows="4"></textarea></p>
                <p><strong>–ó–∞–ø—Ä–µ—Ç –Ω–∞ –¥–æ–Ω–∞—Ü–∏—é:</strong>
                    <input type="checkbox" id="banOnDonation">
                </p>
            </div>
            <h4>–ò—Å—Ç–æ—Ä–∏—è —Å–±–æ—Ä–æ–≤ –∫—Ä–æ–≤–∏</h4>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞ –∑–∞–±–æ—Ä–∞</th>
                        <th>–¢–∏–ø –∑–∞–±–æ—Ä–∞</th>
                        <th>–û–±—ä–µ–º (–º–ª)</th>
                        <th>–í—Ä–∞—á</th>
                        <th>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</th>
                    </tr>
                </thead>
                <tbody id="bloodCollectionHistory"></tbody>
            </table>
        </div>
        <button onclick="saveHistory()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
</div>

<div id="bloodCollectionModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeBloodCollectionModal()">√ó</span>
        <h3>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–±–æ—Ä –∫—Ä–æ–≤–∏</h3>
        <form id="bloodCollectionForm">
            <div class="form-group">
                <label for="donorSearch">–ü–æ–∏—Å–∫ –¥–æ–Ω–æ—Ä–∞:</label>
                <input type="text" id="donorSearch" placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û –∏–ª–∏ –ø–∞—Å–ø–æ—Ä—Ç">
                <div id="donorSearchResults"></div>
            </div>

            <div class="form-group">
                <label for="collectionType">–¢–∏–ø –∑–∞–±–æ—Ä–∞:</label>
                <select id="collectionType" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                    <option value="1">–¶–µ–ª—å–Ω–∞—è –∫—Ä–æ–≤—å</option>
                    <option value="2">–ü–ª–∞–∑–º–∞</option>
                    <option value="3">–¢—Ä–æ–º–±–æ—Ü–∏—Ç—ã</option>
                </select>
            </div>

            <div class="form-group">
                <label for="collectionVolume">–û–±—ä–µ–º (–º–ª):</label>
                <input type="number" id="collectionVolume" required>
            </div>

            <div class="form-group">
                <label for="collectionDate">–î–∞—Ç–∞ –∑–∞–±–æ—Ä–∞:</label>
                <input type="date" id="collectionDate" required>
            </div>

            <div class="form-group">
                <label for="bloodGroup">–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏:</label>
                <select id="bloodGroup" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="AB">AB</option>
                    <option value="O">O</option>
                </select>
            </div>

            <div class="form-group">
                <label for="rhFactor">–†–µ–∑—É—Å-—Ñ–∞–∫—Ç–æ—Ä:</label>
                <select id="rhFactor" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∑—É—Å</option>
                    <option value="+">+</option>
                    <option value="-">-</option>
                </select>
            </div>

            <div class="form-group">
                <label for="examinationResults">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:</label>
                <textarea id="examinationResults" rows="4"></textarea>
            </div>

            <div class="form-group">
                <label for="additionalNotes">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è:</label>
                <textarea id="additionalNotes" rows="2"></textarea>
            </div>

            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </form>
    </div>
</div>

</main>

<div class="footer">
    <span>–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ - –û–û–û "DONOR MIRROR"</span>
</div>

<script src="{{ url_for('static', filename='js/index_scripts.js') }}"></script>
<script src="{{ url_for('static', filename='js/search.js') }}"></script>
<script src="{{ url_for('static', filename='js/addModal.js') }}"></script>
<script src="{{ url_for('static', filename='js/editModal.js') }}"></script>
<script src="{{ url_for('static', filename='js/donorList.js') }}"></script>
<script src="{{ url_for('static', filename='js/bloodCollection.js') }}"></script>
<script src="{{ url_for('static', filename='js/historyModal.js') }}"></script>

</body>
</html>