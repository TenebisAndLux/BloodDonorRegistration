<!DOCTYPE html>
<html lang="ru">
<head>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –¥–æ–Ω–æ—Ä–æ–≤ –∫—Ä–æ–≤–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/list_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modal_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/blood_bank.css') }}">
</head>
<body>
<div class="header">
    <div class="left-group">
        <div class="hospital-name" id="hospital-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="navigation">
            <button onclick="location.href='/donor/list'">‚úé –î–æ–Ω–æ—Ä—ã</button>
            <button onclick="location.href='/reports'">üìú –û—Ç—á–µ—Ç—ã</button>
            <button onclick="location.href='/blood_bank'">üóë –ë–∞–Ω–∫ –∫—Ä–æ–≤–∏</button>
        </div>
    </div>

    <div class="name-container" onmouseenter="showLogoutButton()" onmouseleave="hideLogoutButton()">
        <div class="name" onfocus="showLogoutButton()" id="doctor-name">
            –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>
        <div class="exit-button" style="display: none" onmouseenter="showLogoutButton()"
             onmouseleave="hideLogoutButton()" onclick="location.href='/login'">–í—ã—Ö–æ–¥
        </div>
    </div>
</div>

<div id="loading" style="display: none; text-align: center; padding: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const loadingElement = document.getElementById('loading');

        function showLoading() {
            loadingElement.style.display = 'block';
        }

        function hideLoading() {
            loadingElement.style.display = 'none';
        }

        fetch('/doctor/current')
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    document.getElementById('doctor-name').textContent = '–í—Ä–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    document.getElementById('hospital-name').textContent = '–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
                } else {
                    document.getElementById('doctor-name').textContent = `${data.secondname} ${data.name.charAt(0)}.`;
                    document.getElementById('hospital-name').textContent = data.institutionname;
                    document.getElementById('hospital-name').dataset.institutionCode = data.institutioncode;
                }
                searchBloodSupplies();
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('doctor-name').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                document.getElementById('hospital-name').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                searchBloodSupplies();
                hideLoading();
            });
    });

    function showLogoutButton() {
        document.querySelector('.exit-button').style.display = 'block';
    }

    function hideLogoutButton() {
        document.querySelector('.exit-button').style.display = 'none';
    }
</script>

<div class="container">
    <h1>–ë–∞–Ω–∫ –∫—Ä–æ–≤–∏</h1>

    <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
    <form id="search-form" class="search-form" onsubmit="event.preventDefault(); searchBloodSupplies();">
        <div class="search-row">
            <input type="text" id="blood-group-search" placeholder="–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏">
            <input type="text" id="rh-factor-search" placeholder="–†–µ–∑—É—Å-—Ñ–∞–∫—Ç–æ—Ä">
            <input type="date" id="best-before-date-search" placeholder="–ì–æ–¥–µ–Ω –¥–æ">
            <button type="submit" class="search-button">–ü–æ–∏—Å–∫</button>
            <button type="button" class="clear-button" onclick="clearSearch()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
    </form>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å –∑–∞–ø–∞—Å–∞–º–∏ –∫—Ä–æ–≤–∏ -->
    <div class="table-container">
        <table id="blood-supplies-table">
            <thead>
                <tr>
                    <th>–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏</th>
                    <th>–†–µ–∑—É—Å-—Ñ–∞–∫—Ç–æ—Ä</th>
                    <th>–û–±—ä–µ–º (–º–ª)</th>
                    <th>–î–∞—Ç–∞ –∑–∞–≥–æ—Ç–æ–≤–∫–∏</th>
                    <th>–ì–æ–¥–µ–Ω –¥–æ</th>
                    <th>–¢–∏–ø –∑–∞–≥–æ—Ç–æ–≤–∫–∏</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="blood-supplies-body">
                <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <div class="pagination">
        <button id="prev-page" onclick="prevPage()">–ù–∞–∑–∞–¥</button>
        <span id="page-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>
        <button id="next-page" onclick="nextPage()">–í–ø–µ—Ä–µ–¥</button>
    </div>
</div>
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Yandex Maps API -->
<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=–≤–∞—à_api_–∫–ª—é—á"></script>

<script src="{{ url_for('static', filename='js/bloodBankScripts.js') }}"></script>
<script src="{{ url_for('static', filename='js/index_scripts.js') }}"></script>
<script src="{{ url_for('static', filename='js/common.js') }}"></script>
</body>
</html>