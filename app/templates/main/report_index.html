<!DOCTYPE html>
<html lang="ru">
<head>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –¥–æ–Ω–æ—Ä–æ–≤ –∫—Ä–æ–≤–∏ - –í—ã–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–æ–≤</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/report_styles.css') }}">
</head>
<body>
<div class="header">
    <div class="left-group">
        <div class="hospital-name" id="hospital-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="navigation">
            <button onclick="location.href='/donor/list'">‚úé –î–æ–Ω–æ—Ä—ã</button>
            <button onclick="location.href='/reports'">üìú –û—Ç—á–µ—Ç—ã</button>
            <button onclick="location.href='/blood_bank'">üóë –ë–∞–Ω–∫ –∫—Ä–æ–≤–∏</button>
        </div>
    </div>

    <div class="name-container" onmouseenter="showLogoutButton()" onmouseleave="hideLogoutButton()">
        <div class="name" onfocus="showLogoutButton()" id="doctor-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="exit-button" style="display: none" onmouseenter="showLogoutButton()" onmouseleave="hideLogoutButton()" onclick="location.href='/login'">–í—ã—Ö–æ–¥</div>
    </div>
</div>

<div id="loading" style="display: none; text-align: center; padding: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const loadingElement = document.getElementById('loading');

        function showLoading() {
            loadingElement.style.display = 'block';
        }

        function hideLoading() {
            loadingElement.style.display = 'none';
        }

        fetch('/doctor/current')
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    document.getElementById('doctor-name').textContent = '–í—Ä–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    document.getElementById('hospital-name').textContent = '–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
                } else {
                    document.getElementById('doctor-name').textContent = `${data.secondname} ${data.name.charAt(0)}.`;
                    document.getElementById('hospital-name').textContent = data.institutionname;
                    document.getElementById('hospital-name').dataset.institutionCode = data.institutioncode;
                }
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('doctor-name').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                document.getElementById('hospital-name').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                hideLoading();
            });
    });
</script>


<div class="content-wrapper">
    <div class="reports-container">
        <h2>–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤</h2>

        <div class="report-section">
            <h3>1. –û—Ç—á–µ—Ç –æ –¥–æ–Ω–æ—Ä–µ</h3>
            <div class="report-content">
                <div class="preview-content" id="preview-content-1">
                    <p>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞ –æ –¥–æ–Ω–æ—Ä–µ</p>
                </div>
                <form id="report1-form" class="report-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="form-group">
                        <label for="collectiontypecode">–ö–æ–¥ —Ç–∏–ø–∞ —Å–±–æ—Ä–∞</label>
                        <select id="collectiontypecode" name="collectiontypecode" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–±–æ—Ä–∞</option>
                            {% for type in collection_types %}
                            <option value="{{ type.collectiontypecode }}">{{ type.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="institutioncode">–ö–æ–¥ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è</label>
                        <select id="institutioncode" name="institutioncode" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ</option>
                            {% for institution in institutions %}
                            <option value="{{ institution.institutioncode }}">{{ institution.nameofinstitution }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="numberstock">–ù–æ–º–µ—Ä –∑–∞–ø–∞—Å–∞</label>
                        <select id="numberstock" name="numberstock" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä –∑–∞–ø–∞—Å–∞</option>
                            {% for stock in stocks %}
                            <option value="{{ stock.numberstock }}">{{ stock.numberstock }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="number">–ù–æ–º–µ—Ä</label>
                        <select id="number" name="number" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä</option>
                            {% for num in numbers %}
                            <option value="{{ num.number }}">{{ num.number }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="button" onclick="generateReport(1)">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å DOCX</button>
                </form>
            </div>
        </div>

        <div class="report-section">
            <h3>2. –°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ —É—á—Ä–µ–∂–¥–µ–Ω–∏—é</h3>
            <div class="report-content">
                <div class="preview-content" id="preview-content-2">
                    <p>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–¥–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞</p>
                </div>
                <form id="report2-form" class="report-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="form-group">
                        <label for="institutioncode2">–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ</label>
                        <select id="institutioncode2" name="institutioncode" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ</option>
                            {% for institution in institutions %}
                            <option value="{{ institution.institutioncode }}">{{ institution.nameofinstitution }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="start_date">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞</label>
                        <input type="date" id="start_date" name="start_date" required>
                    </div>
                    <div class="form-group">
                        <label for="end_date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞</label>
                        <input type="date" id="end_date" name="end_date" required>
                    </div>
                    <button type="button" onclick="generateReport(2)">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å DOCX</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="footer">
    <span>–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ - –û–û–û "DONOR MIRROR"</span>
</div>

<script src="{{ url_for('static', filename='js/reportScripts.js') }}"></script>
<script src="{{ url_for('static', filename='js/index_scripts.js') }}"></script>
</body>
</html>