<!DOCTYPE html>
<html lang="ru">
<head>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –¥–æ–Ω–æ—Ä–æ–≤ –∫—Ä–æ–≤–∏ - –í—Ä–∞—á–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/list_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modal_styles.css') }}">
</head>
<body>
<div class="header">
    <div class="left-group">
        <div class="hospital-name" id="hospital-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="navigation">
            <button onclick="location.href='/doctor/list'">üë©‚Äç‚öïÔ∏è –î–æ–∫—Ç–æ—Ä–∞</button>
            <button onclick="location.href='/medical_institution/list'">üè• –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</button>
        </div>
    </div>

    <div class="name-container" onmouseenter="showLogoutButton()" onmouseleave="hideLogoutButton()">
        <div class="name" onfocus="showLogoutButton()" id="doctor-name">
            –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>
        <div class="exit-button" style="display: none" onmouseenter="showLogoutButton()"
             onmouseleave="hideLogoutButton()" onclick="location.href='/login'">–í—ã—Ö–æ–¥
        </div>
    </div>
</div>

<div id="loading" style="display: none; text-align: center; padding: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const loadingElement = document.getElementById('loading');

        function showLoading() {
            loadingElement.style.display = 'block';
        }

        function hideLoading() {
            loadingElement.style.display = 'none';
        }

        fetch('/doctor/current')
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    document.getElementById('doctor-name').textContent = '–í—Ä–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    document.getElementById('hospital-name').textContent = '–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
                } else {
                    document.getElementById('doctor-name').textContent = `${data.secondname} ${data.name.charAt(0)}.`;
                    document.getElementById('hospital-name').textContent = data.institutionname;
                    document.getElementById('hospital-name').dataset.institutionCode = data.institutioncode;
                }
                loadDoctors();
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('doctor-name').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                document.getElementById('hospital-name').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                loadDoctors();
                hideLoading();
            });
    });
</script>

<main class="content-wrapper">

<div class="search-container">
    <form id="search-form">
        <table>
            <tr>
                <th><label for="secondname">–§–∞–º–∏–ª–∏—è:</label></th>
                <td><input type="text" id="secondname" name="secondname"></td>
                <th><label for="name">–ò–º—è:</label></th>
                <td><input type="text" id="name" name="name"></td>
            </tr>
            <tr>
                <th><label for="servicenumber">–¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä:</label></th>
                <td><input type="text" id="servicenumber" name="servicenumber"></td>
                <th><label for="jobtitle">–î–æ–ª–∂–Ω–æ—Å—Ç—å:</label></th>
                <td><input type="text" id="jobtitle" name="jobtitle"></td>
            </tr>
            <tr>
                <td colspan="4" style="text-align: right;">
                    <button type="button" onclick="searchDoctors()">–ù–∞–π—Ç–∏</button>
                    <button type="reset">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </td>
            </tr>
        </table>
    </form>
</div>

<div class="action-buttons">
    <button onclick="addDoctorModal()">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—Ç–æ—Ä–∞</button>
</div>

<div id="addDoctorModal" class="modal-add">
    <div class="modal-add-content">
        <span class="close" onclick="closeAddModal()">√ó</span>
        <form id="addDoctorForm">
            <table>
                <tr>
                    <th><label for="addDoctorName">–ò–º—è:</label></th>
                    <td><input type="text" id="addDoctorName" name="name" required></td>
                    <th><label for="addDoctorSecondName">–§–∞–º–∏–ª–∏—è:</label></th>
                    <td><input type="text" id="addDoctorSecondName" name="secondname" required></td>
                </tr>
                <tr>
                    <th><label for="addDoctorJobTitle">–î–æ–ª–∂–Ω–æ—Å—Ç—å:</label></th>
                    <td><input type="text" id="addDoctorJobTitle" name="jobtitle" required></td>
                    <th><label for="addDoctorRole">–†–æ–ª—å:</label></th>
                    <td>
                        <select id="addDoctorRole" name="role" required>
                            <option value="doctor">–í—Ä–∞—á</option>
                            <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th><label for="addDoctorLogin">–õ–æ–≥–∏–Ω:</label></th>
                    <td><input type="text" id="addDoctorLogin" name="login" required></td>
                    <th><label for="addDoctorPassword">–ü–∞—Ä–æ–ª—å:</label></th>
                    <td><input type="password" id="addDoctorPassword" name="password" required></td>
                </tr>
                <tr>
                    <th><label for="addDoctorEmail">Email:</label></th>
                    <td colspan="3"><input type="email" id="addDoctorEmail" name="email" required></td>
                </tr>
            </table>
            <div class="modal-add-action-buttons">
                <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<div id="editDoctorModal" class="modal-edit">
    <div class="modal-edit-content">
        <span class="close" onclick="closeEditModal()">√ó</span>
        <form id="editDoctorForm">
            <input type="hidden" id="editDoctorInstitutionCode" name="institutioncode">
            <input type="hidden" id="editDoctorServiceNumber" name="servicenumber">
            <table>
                <tr>
                    <th><label for="editDoctorName">–ò–º—è:</label></th>
                    <td><input type="text" id="editDoctorName" name="name" required></td>
                    <th><label for="editDoctorSecondName">–§–∞–º–∏–ª–∏—è:</label></th>
                    <td><input type="text" id="editDoctorSecondName" name="secondname" required></td>
                </tr>
                <tr>
                    <th><label for="editDoctorJobTitle">–î–æ–ª–∂–Ω–æ—Å—Ç—å:</label></th>
                    <td><input type="text" id="editDoctorJobTitle" name="jobtitle" required></td>
                    <th><label for="editDoctorRole">–†–æ–ª—å:</label></th>
                    <td>
                        <select id="editDoctorRole" name="role" required>
                            <option value="doctor">–í—Ä–∞—á</option>
                            <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th><label for="editDoctorLogin">–õ–æ–≥–∏–Ω:</label></th>
                    <td><input type="text" id="editDoctorLogin" name="login" required></td>
                    <th><label for="editDoctorPassword">–ü–∞—Ä–æ–ª—å:</label></th>
                    <td><input type="password" id="editDoctorPassword" name="password" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å"></td>
                </tr>
                <tr>
                    <th><label for="editDoctorEmail">Email:</label></th>
                    <td colspan="3"><input type="email" id="editDoctorEmail" name="email" required></td>
                </tr>
            </table>
            <div class="modal-edit-action-buttons">
                <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </form>
    </div>
</div>

<table class="donors-list">
    <thead>
    <tr>
        <th>–§–ò–û</th>
        <th>–¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä</th>
        <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
        <th>–†–æ–ª—å</th>
        <th>–õ–æ–≥–∏–Ω</th>
        <th>Email</th>
        <th>–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
    </thead>
    <tbody id="doctors-list">
    </tbody>
</table>

<div id="dismissModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeDismissModal()">√ó</span>
        <h3>–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ –≤—Ä–∞—á–∞</h3>
        <p>–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–≤–æ–ª–∏—Ç—å –≤—Ä–∞—á–∞: <span id="dismissDoctorName"></span></p>
        <p>–í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–Ω—ã –¥—Ä—É–≥–æ–º—É –≤—Ä–∞—á—É:</p>
        <div class="form-group">
            <label for="transferToDoctor">–ü–µ—Ä–µ–¥–∞—Ç—å –∑–∞–ø–∏—Å–∏ –≤—Ä–∞—á—É:</label>
            <select id="transferToDoctor" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–∞—á–∞</option>
            </select>
        </div>
        <button onclick="confirmDismissal()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–≤–æ–ª—å–Ω–µ–Ω–∏–µ</button>
    </div>
</div>

</main>

<div class="footer">
    <span>–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ - –û–û–û "DONOR MIRROR"</span>
</div>

<script src="{{ url_for('static', filename='js/doctorList.js') }}"></script>
<script src="{{ url_for('static', filename='js/doctorAddModal.js') }}"></script>
<script src="{{ url_for('static', filename='js/doctorEditModal.js') }}"></script>
<script src="{{ url_for('static', filename='js/doctorDismissModal.js') }}"></script>
<script src="{{ url_for('static', filename='js/index_scripts.js') }}"></script>

</body>
</html>